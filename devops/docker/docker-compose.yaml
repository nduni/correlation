version: '3.8'
services:

  corr-rabbitmq:
    image: rabbitmq:latest
    build: ./dockerfiles/rabbitmq/
    ports:
      - "15672:15672"
      - "5672:5672"

  weather-acceptor:
    image: weather-acceptor
    build:
      context: ../../
      dockerfile: weather/weather-acceptor/Dockerfile
    environment:
      DEPLOYMENT_ENV: ${DEPLOYMENT_ENV}
    depends_on: 
      - corr-rabbitmq
    restart: unless-stopped

  weather-processor:
    image: weather-processor
    build:
      context: ../../
      dockerfile: weather/weather-processor/Dockerfile
    environment:
      DEPLOYMENT_ENV: ${DEPLOYMENT_ENV}
    depends_on: 
      - corr-rabbitmq
    restart: unless-stopped

networks:
  default:
    name: message-network